"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[959],{5680:(e,t,o)=>{o.d(t,{xA:()=>u,yg:()=>f});var n=o(6540);function l(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){l(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function a(e,t){if(null==e)return{};var o,n,l=function(e,t){if(null==e)return{};var o,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(l[o]=e[o]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(l[o]=e[o])}return l}var d=n.createContext({}),s=function(e){var t=n.useContext(d),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},u=function(e){var t=s(e.components);return n.createElement(d.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var o=e.components,l=e.mdxType,r=e.originalType,d=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),c=s(o),g=l,f=c["".concat(d,".").concat(g)]||c[g]||p[g]||r;return o?n.createElement(f,i(i({ref:t},u),{},{components:o})):n.createElement(f,i({ref:t},u))}));function f(e,t){var o=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=o.length,i=new Array(r);i[0]=g;var a={};for(var d in t)hasOwnProperty.call(t,d)&&(a[d]=t[d]);a.originalType=e,a[c]="string"==typeof e?e:l,i[1]=a;for(var s=2;s<r;s++)i[s]=o[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}g.displayName="MDXCreateElement"},903:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>s});var n=o(8168),l=(o(6540),o(5680));const r={sidebar_position:5},i="Detox",a={unversionedId:"workflows/detox",id:"workflows/detox",title:"Detox",description:"Set up workflow to run Detox E2E tests for every Pull Request.",source:"@site/docs/workflows/detox.mdx",sourceDirName:"workflows",slug:"/workflows/detox",permalink:"/setup-ci/docs/workflows/detox",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Prettier check",permalink:"/setup-ci/docs/workflows/prettier"},next:{title:"Maestro",permalink:"/setup-ci/docs/workflows/maestro"}},d={},s=[{value:"Usage",id:"usage",level:2},{value:"Detailed behavior",id:"detailed-behavior",level:2},{value:"Installed dependencies",id:"installed-dependencies",level:3},{value:"Manual native code patch",id:"manual-native-code-patch",level:3},{value:"Release build workflow",id:"release-build-workflow",level:3},{value:"Modified and created files",id:"modified-and-created-files",level:3},{value:"Workflow details",id:"workflow-details",level:3},{value:"test-detox-android",id:"test-detox-android",level:4},{value:"test-detox-ios",id:"test-detox-ios",level:4},{value:"Known issues and limitations",id:"known-issues-and-limitations",level:2}],u={toc:s},c="wrapper";function p(e){let{components:t,...o}=e;return(0,l.yg)(c,(0,n.A)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,l.yg)("h1",{id:"detox"},"Detox"),(0,l.yg)("p",null,"Set up workflow to run Detox E2E tests for every Pull Request."),(0,l.yg)("p",null,"Learn more about Detox: ",(0,l.yg)("a",{parentName:"p",href:"https://wix.github.io/Detox/"},"wix.github.io/Detox")),(0,l.yg)("h2",{id:"usage"},"Usage"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-bash"},"npx setup-ci --preset --detox\n")),(0,l.yg)("h2",{id:"detailed-behavior"},"Detailed behavior"),(0,l.yg)("p",null,"Below you can find detailed information about what the script does with your project when generating Detox workflow."),(0,l.yg)("h3",{id:"installed-dependencies"},"Installed dependencies"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"detox")," (dev)"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"jest")," (dev)"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"typescript")," (dev)"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"ts-jest")," (dev)"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"@types/jest")," (dev)"),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"@config-plugins/detox")," (dev) (if project uses Expo)")),(0,l.yg)("h3",{id:"manual-native-code-patch"},"Manual native code patch"),(0,l.yg)("p",null,"If your project is not using Expo, you will have to manually patch the native code to make Detox work.\nSCI will provide you with the necessary instructions. Specifically, it will ask you to follow step 4 from\n",(0,l.yg)("a",{parentName:"p",href:"https://wix.github.io/Detox/docs/next/introduction/project-setup/#step-4-additional-android-configuration"},"Detox project setup"),"."),(0,l.yg)("h3",{id:"release-build-workflow"},"Release build workflow"),(0,l.yg)("p",null,"To test the app with Detox, we need to first build the app in release mode. Therefore, apart from\nCI workflow to run Detox tests, SCI will generate workflows for building the app, on which the Detox\nworkflow depends. You can read more about the release build workflow in ",(0,l.yg)("a",{parentName:"p",href:"/docs/aux-workflows/build-release"},"Release build"),"."),(0,l.yg)("h3",{id:"modified-and-created-files"},"Modified and created files"),(0,l.yg)("table",null,(0,l.yg)("tr",null,(0,l.yg)("th",{style:{width:"40%"}},"File"),(0,l.yg)("th",null,"Changes")),(0,l.yg)("tr",null,(0,l.yg)("td",null,(0,l.yg)("code",null,".github/workflows/test-detox-android.yml")),(0,l.yg)("td",null,"Contains the CI workflow for Detox on Android")),(0,l.yg)("tr",null,(0,l.yg)("td",null,(0,l.yg)("code",null,".github/workflows/test-detox-ios.yml")),(0,l.yg)("td",null,"Contains the CI workflow for Detox on iOS")),(0,l.yg)("tr",null,(0,l.yg)("td",null,(0,l.yg)("code",null,"package.json")),(0,l.yg)("td",null,(0,l.yg)("ul",null,(0,l.yg)("li",null,"Missing dependencies are added"),(0,l.yg)("li",null,"New script: ",(0,l.yg)("code",null,"detox:test:android: detox test --config-path .detoxrc-ci.js --configuration android.emu.release --cleanup")),(0,l.yg)("li",null,"New script: ",(0,l.yg)("code",null,"detox:test:ios: detox test --config-path .detoxrc-ci.js --configuration ios.sim.release --cleanup"))))),(0,l.yg)("tr",null,(0,l.yg)("td",null,(0,l.yg)("code",null,"app.json")),(0,l.yg)("td",null,"Add ",(0,l.yg)("code",null,"@config-plugins/detox")," to ",(0,l.yg)("code",null,"expo.plugins")," if project uses Expo (if ",(0,l.yg)("code",null,"app.config.js")," is detected instead, SCI will prompt you to add it manually)")),(0,l.yg)("tr",null,(0,l.yg)("td",null,(0,l.yg)("code",null,".detoxrc-ci.js")),(0,l.yg)("td",null,"Created with Detox configuration for CI")),(0,l.yg)("tr",null,(0,l.yg)("td",null,(0,l.yg)("code",null,"e2e/jest.config.js")),(0,l.yg)("td",null,"Jest configuration for Detox, created if no ",(0,l.yg)("code",null,"e2e")," directory is detected")),(0,l.yg)("tr",null,(0,l.yg)("td",null,(0,l.yg)("code",null,"e2e/starter.test.ts")),(0,l.yg)("td",null,"Example Detox test, created if no ",(0,l.yg)("code",null,"e2e")," directory is detected"))),(0,l.yg)("h3",{id:"workflow-details"},"Workflow details"),(0,l.yg)("h4",{id:"test-detox-android"},"test-detox-android"),(0,l.yg)("p",null,"The following diagram represents the flow of ",(0,l.yg)("inlineCode",{parentName:"p"},"test-detox-android")," workflow:"),(0,l.yg)("mermaid",{value:'flowchart TD;\n    A["\u231b Wait for release build to finish\\nUsing <a href=\'/setup-ci/docs/aux-workflows/build-release\'>build-release</a>"]--\x3eB["\ud83c\udf3f Setup Node"];\n    B--\x3eC["\ud83d\udce6 Install dependencies"];\n    C--\x3eD["\u2615 Setup JDK 17"]\n    D--\x3eE["\ud83d\udc18 Setup Gradle 8.8"]\n    E--\x3eF["\ud83d\udc1b Restore release build from cache"]\n    F--\x3eG["\ud83c\udfce\ufe0f Enable KVM\\n<a href=\'https://github.com/ReactiveCircus/android-emulator-runner?tab=readme-ov-file#running-hardware-accelerated-emulators-on-linux-runners\'>Learn more</a>"]\n    G--\x3eH["\ud83d\udcf1 AVD cache\\n<a href=\'https://github.com/ReactiveCircus/android-emulator-runner?tab=readme-ov-file#usage--examples\'>Learn more</a>"]\n    H--\x3eI["\ud83d\udccb Run Detox tests [yarn detox:test:android]\\nUsing <a href=\'https://github.com/ReactiveCircus/android-emulator-runner\'>Android Emulator Runner</a>"]'}),(0,l.yg)("h4",{id:"test-detox-ios"},"test-detox-ios"),(0,l.yg)("p",null,"The following diagram represents the flow of ",(0,l.yg)("inlineCode",{parentName:"p"},"test-detox-ios")," workflow:"),(0,l.yg)("mermaid",{value:'flowchart TD;\n    A["\u231b Wait for release build to finish\\nUsing <a href=\'/setup-ci/docs/aux-workflows/build-release\'>build-release</a>"]--\x3eB["\ud83c\udf3f Setup Node"];\n    B--\x3eC["\ud83d\udce6 Install dependencies"];\n    C--\x3eD["\ud83d\udc1b Restore release build from cache"]\n    D--\x3eE["\ud83d\udccb Run Detox tests [yarn detox:test:ios]"]'}),(0,l.yg)("h2",{id:"known-issues-and-limitations"},"Known issues and limitations"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},"Currently Detox tests are run on release builds. This means that the app will have to be built\nevery time the code changes (native or JS). This can be time-consuming and if you would like\nto save this time, consider using ",(0,l.yg)("a",{parentName:"li",href:"/docs/workflows/maestro"},"Maestro workflow")," which is run\non debug build. This allows for caching and rebuilding the app only if native code changes,\nwhich results in significant resource and time savings.")))}p.isMDXComponent=!0}}]);